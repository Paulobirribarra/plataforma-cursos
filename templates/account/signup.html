{% extends 'base.html' %}
{% load i18n %}

{% block content %}
<div class="max-w-md mx-auto bg-white p-6 rounded-lg shadow-md">
    <h1 class="text-2xl font-bold mb-4 text-center text-gray-800">Registrarse</h1>
    
    {% if form.errors %}
        <div class="bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded mb-4">
            <div class="flex items-center">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <p class="font-medium">Por favor, corrige los errores indicados abajo.</p>
            </div>
            {% if form.non_field_errors %}
                <ul class="ml-6 mt-2 list-disc">
                    {% for error in form.non_field_errors %}
                        <li class="text-sm">{{ error }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
        </div>
    {% endif %}
    
    <form method="post" action="{% url 'account_signup' %}" novalidate>
        {% csrf_token %}        <div class="mb-4">
            <label for="id_email" class="block text-sm font-medium">Correo</label>
            <input type="email" name="email" id="id_email" 
                   class="w-full p-2 border rounded {% if form.email.errors %}border-red-500{% endif %}" 
                   required>
            {% if form.email.errors %}
                <div class="text-red-600 text-sm mt-1">
                    {% for error in form.email.errors %}
                        <p>{{ error }}</p>
                    {% endfor %}
                </div>
            {% endif %}
        </div>        <div class="mb-4">
            <label for="id_username" class="block text-sm font-medium">Nombre de usuario</label>
            <input type="text" name="username" id="id_username" 
                   class="w-full p-2 border rounded {% if form.username.errors %}border-red-500{% endif %}">
            {% if form.username.errors %}
                <div class="text-red-600 text-sm mt-1">
                    {% for error in form.username.errors %}
                        <p>{{ error }}</p>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
        <div class="mb-4">
            <label for="id_full_name" class="block text-sm font-medium">Nombre completo</label>
            <input type="text" name="full_name" id="id_full_name" 
                   class="w-full p-2 border rounded {% if form.full_name.errors %}border-red-500{% endif %}">
            {% if form.full_name.errors %}
                <div class="text-red-600 text-sm mt-1">
                    {% for error in form.full_name.errors %}
                        <p>{{ error }}</p>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
        <div class="mb-4">
            <label for="id_phone" class="block text-sm font-medium">Teléfono</label>
            <input type="text" name="phone" id="id_phone" 
                   class="w-full p-2 border rounded {% if form.phone.errors %}border-red-500{% endif %}">
            {% if form.phone.errors %}
                <div class="text-red-600 text-sm mt-1">
                    {% for error in form.phone.errors %}
                        <p>{{ error }}</p>
                    {% endfor %}
                </div>
            {% endif %}
        </div><div class="mb-4">            <label for="id_password1" class="block text-sm font-medium">Contraseña</label>
            <input type="password" name="password1" id="id_password1" 
                   class="w-full p-2 border rounded {% if form.password1.errors %}border-red-500{% endif %}" 
                   required>
            {% if form.password1.errors %}
                <div class="text-red-600 text-sm mt-1">
                    {% for error in form.password1.errors %}
                        <p>{{ error }}</p>
                    {% endfor %}
                </div>
            {% endif %}
            <div class="text-xs text-gray-600 mt-1">
                <p class="font-semibold">La contraseña debe:</p>
                <ul class="list-disc ml-4 mt-1">
                    <li>Tener al menos 8 caracteres</li>
                    <li>Contener al menos una letra mayúscula (A-Z)</li>
                    <li>Contener al menos una letra minúscula (a-z)</li>
                    <li>Contener al menos un número (0-9)</li>
                    <li>Contener al menos un carácter especial (!, @, #, etc.)</li>
                </ul>
            </div>
        </div>
        <div class="mb-4">            <label for="id_password2" class="block text-sm font-medium">Confirmar Contraseña</label>
            <input type="password" name="password2" id="id_password2" 
                   class="w-full p-2 border rounded {% if form.password2.errors %}border-red-500{% endif %}" 
                   required>
            {% if form.password2.errors %}
                <div class="text-red-600 text-sm mt-1">
                    {% for error in form.password2.errors %}
                        <p>{{ error }}</p>
                    {% endfor %}
                </div>
            {% endif %}
        </div>        <button type="submit" id="signup-button" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors w-full">Registrarse</button>
    </form>
    <p class="mt-4 text-center">
        <a href="{% url 'account_login' %}" class="text-blue-600 hover:underline">Ya tengo una cuenta</a>
    </p>
</div>

<script>
    // Validación básica en el cliente
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.querySelector('form');
        const password1 = document.getElementById('id_password1');
        const password2 = document.getElementById('id_password2');
        const signupButton = document.getElementById('signup-button');
        
        // Función para validar la contraseña
        function validatePassword() {
            const value = password1.value;
            const validations = {
                length: value.length >= 8,
                uppercase: /[A-Z]/.test(value),
                lowercase: /[a-z]/.test(value),
                number: /[0-9]/.test(value),
                special: /[!@#$%^&*()_+\-=\[\]{};:"\\|,.<>\/?]/.test(value)
            };
            
            return validations;
        }
        
        // Función para mostrar errores en tiempo real
        password1.addEventListener('input', function() {
            const validations = validatePassword();
            
            // Actualizar el estilo del campo según si cumple todos los requisitos
            if (Object.values(validations).every(v => v)) {
                password1.classList.remove('border-red-500');
                password1.classList.add('border-green-500');
            } else {
                password1.classList.remove('border-green-500');
                // No agregar borde rojo durante la escritura para no ser intrusivo
            }
        });
        
        // Validar coincidencia de contraseñas
        password2.addEventListener('input', function() {
            if (password1.value === password2.value) {
                password2.classList.remove('border-red-500');
                password2.classList.add('border-green-500');
            } else {
                password2.classList.remove('border-green-500');
                password2.classList.add('border-red-500');
            }
        });
        
        // Validación al enviar el formulario
        form.addEventListener('submit', function(e) {
            const validations = validatePassword();
            const passwordMatch = password1.value === password2.value;
            
            // Si hay errores, prevenir el envío
            if (!Object.values(validations).every(v => v) || !passwordMatch) {
                e.preventDefault();
                
                // Crear un mensaje de error
                let errorMessage = 'Por favor, corrige los siguientes errores:';
                errorMessage += '<ul class="list-disc ml-5 mt-2">';
                
                if (!validations.length) errorMessage += '<li>La contraseña debe tener al menos 8 caracteres.</li>';
                if (!validations.uppercase) errorMessage += '<li>La contraseña debe contener al menos una letra mayúscula.</li>';
                if (!validations.lowercase) errorMessage += '<li>La contraseña debe contener al menos una letra minúscula.</li>';
                if (!validations.number) errorMessage += '<li>La contraseña debe contener al menos un número.</li>';
                if (!validations.special) errorMessage += '<li>La contraseña debe contener al menos un carácter especial.</li>';
                if (!passwordMatch) errorMessage += '<li>Las contraseñas no coinciden.</li>';
                
                errorMessage += '</ul>';
                
                // Mostrar el mensaje en la parte superior
                const errorDiv = document.createElement('div');
                errorDiv.className = 'bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded mb-4';
                errorDiv.innerHTML = errorMessage;
                
                // Si ya existe un mensaje de error, reemplazarlo
                const existingError = document.querySelector('.bg-red-50');
                if (existingError) {
                    existingError.replaceWith(errorDiv);
                } else {
                    form.prepend(errorDiv);
                }
                
                // Hacer scroll al principio del formulario
                window.scrollTo(0, 0);
            }
        });
    });
</script>
</div>
{% endblock %}