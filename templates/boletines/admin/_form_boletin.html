{% load widget_tweaks %}

<!-- Formulario de bolet√≠n reutilizable -->
<form method="post" enctype="multipart/form-data" id="boletin-form" class="space-y-8">
    {% csrf_token %}
    
    <!-- Errores del formulario -->
    {% if form.errors %}
    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
        <div class="flex items-center mb-2">
            <svg class="w-5 h-5 text-red-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <h3 class="text-sm font-medium text-red-800">Por favor corrige los siguientes errores:</h3>
        </div>
        <div class="text-sm text-red-700 space-y-1">
            {% for field in form %}
                {% for error in field.errors %}
                    <p>‚Ä¢ <strong>{{ field.label }}:</strong> {{ error }}</p>
                {% endfor %}
            {% endfor %}
            {% for error in form.non_field_errors %}
                <p>‚Ä¢ {{ error }}</p>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Informaci√≥n B√°sica -->
    <div class="bg-white rounded-xl shadow-xl p-6 border border-gray-100">
        <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
            üìù Informaci√≥n B√°sica
        </h3>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- T√≠tulo -->
            <div class="campo-requerido md:col-span-2">
                <label for="{{ form.titulo.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                    {{ form.titulo.label }}
                </label>
                {{ form.titulo|add_class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors" }}
                {% if form.titulo.errors %}
                    <div class="error-message">{{ form.titulo.errors.0 }}</div>
                {% endif %}
                <div class="help-text">Escribe un t√≠tulo claro y atractivo para el bolet√≠n</div>
            </div>

            <!-- Categor√≠a -->
            <div class="campo-requerido">
                <label for="{{ form.categoria.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                    {{ form.categoria.label }}
                </label>
                {{ form.categoria|add_class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors" }}
                {% if form.categoria.errors %}
                    <div class="error-message">{{ form.categoria.errors.0 }}</div>
                {% endif %}
            </div>

            <!-- Prioridad -->
            <div>
                <label for="{{ form.prioridad.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                    {{ form.prioridad.label }}
                </label>
                {{ form.prioridad|add_class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors" }}
                {% if form.prioridad.errors %}
                    <div class="error-message">{{ form.prioridad.errors.0 }}</div>
                {% endif %}
                <div class="help-text">Alta prioridad aparece primero en la lista</div>
            </div>
        </div>
    </div>

    <!-- Contenido -->
    <div class="bg-white rounded-xl shadow-xl p-6 border border-gray-100">
        <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
            üìÑ Contenido del Bolet√≠n
        </h3>
        
        <div class="space-y-6">
            <!-- Resumen -->
            <div>
                <label for="{{ form.resumen.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                    {{ form.resumen.label }}
                </label>
                {{ form.resumen|add_class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors" }}
                {% if form.resumen.errors %}
                    <div class="error-message">{{ form.resumen.errors.0 }}</div>
                {% endif %}
                <div class="help-text">Breve descripci√≥n que aparecer√° en la vista previa del email</div>
            </div>

            <!-- Contenido principal -->
            <div class="campo-requerido">
                <label for="{{ form.contenido.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                    {{ form.contenido.label }}
                </label>
                {{ form.contenido }}
                {% if form.contenido.errors %}
                    <div class="error-message">{{ form.contenido.errors.0 }}</div>
                {% endif %}
                <div class="help-text">Contenido principal del bolet√≠n (HTML permitido)</div>
            </div>

            <!-- Imagen destacada -->
            {% if form.imagen_destacada %}
            <div>
                <label for="{{ form.imagen_destacada.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                    {{ form.imagen_destacada.label }}
                </label>
                {{ form.imagen_destacada|add_class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors" }}
                {% if form.imagen_destacada.errors %}
                    <div class="error-message">{{ form.imagen_destacada.errors.0 }}</div>
                {% endif %}
                <div class="help-text">Imagen que aparecer√° en el bolet√≠n (opcional)</div>
                
                {% if object.imagen_destacada %}
                <div class="mt-3">
                    <p class="text-sm text-gray-600 mb-2">Imagen actual:</p>
                    <img src="{{ object.imagen_destacada.url }}" alt="Imagen actual" class="max-w-xs rounded-lg border">
                </div>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Configuraci√≥n Avanzada -->
    <div class="bg-white rounded-xl shadow-xl p-6 border border-gray-100">
        <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
            ‚öôÔ∏è Configuraci√≥n Avanzada
        </h3>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Solo suscriptores premium -->
            {% if form.solo_suscriptores_premium %}
            <div>
                <div class="flex items-center">
                    {{ form.solo_suscriptores_premium|add_class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded mr-3" }}
                    <label for="{{ form.solo_suscriptores_premium.id_for_label }}" class="text-sm font-medium text-gray-700">
                        {{ form.solo_suscriptores_premium.label }}
                    </label>
                </div>
                {% if form.solo_suscriptores_premium.errors %}
                    <div class="error-message">{{ form.solo_suscriptores_premium.errors.0 }}</div>
                {% endif %}
                <div class="help-text">Solo se enviar√° a usuarios con membres√≠a premium activa</div>
            </div>
            {% endif %}

            <!-- Blog relacionado -->
            {% if form.blog_relacionado %}
            <div>
                <label for="{{ form.blog_relacionado.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                    {{ form.blog_relacionado.label }}
                </label>
                {{ form.blog_relacionado|add_class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors" }}
                {% if form.blog_relacionado.errors %}
                    <div class="error-message">{{ form.blog_relacionado.errors.0 }}</div>
                {% endif %}
                <div class="help-text">Enlaza este bolet√≠n con un art√≠culo del blog</div>
            </div>
            {% endif %}

            <!-- Curso relacionado -->
            {% if form.curso_relacionado %}
            <div>
                <label for="{{ form.curso_relacionado.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                    {{ form.curso_relacionado.label }}
                </label>
                {{ form.curso_relacionado|add_class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors" }}
                {% if form.curso_relacionado.errors %}
                    <div class="error-message">{{ form.curso_relacionado.errors.0 }}</div>
                {% endif %}
                <div class="help-text">Enlaza este bolet√≠n con un curso espec√≠fico</div>
            </div>
            {% endif %}
        </div>
    </div>
</form>

<!-- JavaScript para TinyMCE -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    if (typeof tinymce !== 'undefined') {
        tinymce.init({
            selector: '#id_contenido',
            height: 400,
            menubar: false,
            plugins: [
                'advlist', 'autolink', 'lists', 'link', 'image', 'charmap', 'preview',
                'anchor', 'searchreplace', 'visualblocks', 'code', 'fullscreen',
                'insertdatetime', 'media', 'table', 'help', 'wordcount'
            ],
            toolbar: 'undo redo | blocks | bold italic backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | help',
            content_style: 'body { font-family: -apple-system, BlinkMacSystemFont, San Francisco, Segoe UI, Roboto, Helvetica Neue, sans-serif; font-size: 14px; }'
        });
    }
});
</script>
