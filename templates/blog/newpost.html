{% extends 'base.html' %}
{% load static %}
{% block content %}

<form method="post" enctype="multipart/form-data" class="max-w-5xl mx-auto mt-10">
  {% csrf_token %}

  <h1 class="text-3xl font-bold mb-6">Haz un nuevo post</h1>

  <!-- Título -->
  <div class="mb-6">
    <label class="block text-lg font-medium mb-2" for="title">Encabezado / Título</label>
    <input type="text" name="title" id="title"
      class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
      value="{{ form.title.value|default_if_none:'' }}">
    {% if form.title.errors %}
    <p class="text-red-500 text-sm mt-1">{{ form.title.errors.0 }}</p>
    {% endif %}
  </div>

  <!-- Contenido 1 -->
  <div class="mb-6">
    <label class="block text-lg font-medium mb-2" for="intro">Contenido 1</label>
    <textarea name="intro" id="intro" rows="7"
      class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">{{ form.intro.value|default_if_none:'' }}</textarea>
    {% if form.intro.errors %}
    <p class="text-red-500 text-sm mt-1">{{ form.intro.errors.0 }}</p>
    {% endif %}
  </div>

  <!-- Imagen -->
  <div class="mb-6">
    <label class="block text-lg font-medium mb-2" for="id_image">Imagen (opcional)</label>
    {{ form.image }}
    <img id="preview" class="mt-4 max-h-48 hidden mx-auto" alt="Vista previa de la imagen" />
    {% if form.image.errors %}
    <p class="text-red-500 text-sm mt-1">{{ form.image.errors.0 }}</p>
    {% endif %}
  </div>
  <div class="mb-6">
    <label class="block text-lg font-medium mb-2" for="content">Contenido 2</label>
    <textarea name="content" id="content" rows="7"
      class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">{{ form.content.value|default_if_none:'' }}</textarea>
    {% if form.content.errors %}
    <p class="text-red-500 text-sm mt-1">{{ form.content.errors.0 }}</p>
    {% endif %}
  </div>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const imageInput = document.getElementById("id_image");
      const preview = document.getElementById("preview");

      if (imageInput && preview) {
        imageInput.addEventListener("change", function () {
          const file = this.files[0];
          if (file && file.type.startsWith("image/")) {
            const reader = new FileReader();
            reader.onload = function (e) {
              preview.src = e.target.result;
              preview.classList.remove("hidden");
            };
            reader.readAsDataURL(file);
          } else {
            preview.src = "";
            preview.classList.add("hidden");
          }
        });
      }
    });
  </script>
  <!-- Botón -->
  <button type="submit" class="px-6 py-3 bg-blue-600 text-white font-semibold rounded-md hover:bg-blue-700 transition">
    Publicar
  </button>
</form>

{% endblock %}